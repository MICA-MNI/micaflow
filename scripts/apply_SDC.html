

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Apply Sdc &mdash; Micaflow  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=dff4f964" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Apply Warp" href="apply_warp.html" />
    <link rel="prev" title="Scripts" href="../scripts.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Micaflow
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline.html">MICAflow Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pipeline.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline.html#implementation-details">Implementation Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline.html#quality-control">Quality Control</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#example-workflows">Example Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#structural-mri-processing">Structural MRI Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#diffusion-mri-processing">Diffusion MRI Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html#registration-example">Registration Example</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../scripts.html">Scripts</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../scripts.html#quick-reference">Quick Reference</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Micaflow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../scripts.html">Scripts</a></li>
      <li class="breadcrumb-item active">Apply Sdc</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/scripts/apply_SDC.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="apply-sdc">
<h1>Apply Sdc<a class="headerlink" href="#apply-sdc" title="Link to this heading"></a></h1>
<p>apply_SDC - Susceptibility Distortion Correction for diffusion MRI</p>
<p>Part of the micaflow processing pipeline for neuroimaging data.</p>
<p>This module applies susceptibility distortion correction (SDC) to diffusion MRI images
by using a pre-calculated displacement field to unwarp geometric distortions caused by
magnetic field inhomogeneities. These distortions typically occur along the phase-encoding
direction (usually the y-axis).</p>
<p>The module works by:
1. Loading a distorted diffusion image (typically after motion correction)
2. Applying a voxel-wise displacement field to each volume in the 4D image
3. Using linear interpolation to resample the image at the corrected coordinates
4. Saving the unwarped image with the original affine transformation</p>
<section id="api-usage">
<h2>API Usage:<a class="headerlink" href="#api-usage" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>micaflow apply_SDC</dt><dd><p>–input &lt;path/to/distorted_image.nii.gz&gt;
–warp &lt;path/to/field_map.nii.gz&gt;
–affine &lt;path/to/reference_image.nii.gz&gt;
–output &lt;path/to/corrected_output.nii.gz&gt;</p>
</dd>
</dl>
</section>
<section id="python-usage">
<h2>Python Usage:<a class="headerlink" href="#python-usage" title="Link to this heading"></a></h2>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">micaflow.scripts.apply_SDC</span><span class="w"> </span><span class="kn">import</span> <span class="n">apply_SD_correction</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">apply_SD_correction</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">motion_corr_path</span><span class="o">=</span><span class="s2">&quot;distorted_image.nii.gz&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">warp_field</span><span class="o">=</span><span class="n">warp_field_array</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">moving_affine</span><span class="o">=</span><span class="n">affine_matrix</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">output</span><span class="o">=</span><span class="s2">&quot;corrected_output.nii.gz&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="command-line-usage">
<h2>Command Line Usage<a class="headerlink" href="#command-line-usage" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>micaflow<span class="w"> </span>apply_SDC<span class="w"> </span><span class="o">[</span>options<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="source-code">
<h2>Source Code<a class="headerlink" href="#source-code" title="Link to this heading"></a></h2>
<p>View the source code: <a class="reference external" href="https://github.com/MICA-LAB/micaflow/blob/main/micaflow/scripts/apply_SDC.py">GitHub Repository</a></p>
</section>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>This script applies susceptibility distortion correction to diffusion images</dt><dd><p>using a pre-calculated warp field. It takes a motion-corrected diffusion image
and applies the warp field to each 3D volume along the y-axis.</p>
</dd>
</dl>
</section>
<section id="full-help">
<h2>Full Help<a class="headerlink" href="#full-help" title="Link to this heading"></a></h2>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>╔════════════════════════════════════════════════════════════════╗
║          APPLY SUSCEPTIBILITY DISTORTION CORRECTION            ║
╚════════════════════════════════════════════════════════════════╝

This script applies susceptibility distortion correction to diffusion images
using a pre-calculated warp field. It takes a motion-corrected diffusion image
and applies the warp field to each 3D volume along the y-axis.

────────────────────────── USAGE ──────────────────────────
  micaflow apply_SDC [options]

────────────────── REQUIRED ARGUMENTS ───────────────────
  --input       : Path to the motion-corrected DWI image (.nii.gz)
  --warp        : Path to the warp field estimated from SDC (.nii.gz)
  --affine      : Path to an image from which to extract the affine matrix
  --output      : Output path for the corrected image

─────────────────── EXAMPLE USAGE ───────────────────────

# Apply SDC to a motion-corrected DWI image
micaflow apply_SDC \
  --input subj_motion_corrected.nii.gz \
  --warp SDC.nii.gz \
  --affine original_dwi.nii.gz \
  --output corrected_dwi.nii.gz

────────────────────────── NOTES ───────────────────────
• The warp field should contain displacement values along the y-axis
• This implementation assumes that susceptibility distortions are primarily
  in the phase-encoding direction (typically y-axis)
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../scripts.html" class="btn btn-neutral float-left" title="Scripts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="apply_warp.html" class="btn btn-neutral float-right" title="Apply Warp" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, MICA Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>